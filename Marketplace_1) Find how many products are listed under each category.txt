CREATE DATABASE MarketplaceDB;
USE MarketplaceDB;

CREATE TABLE Categories (
    category_ID INT AUTO_INCREMENT PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL
);

CREATE TABLE Products (
    product_ID INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2),
    category_ID INT,
    FOREIGN KEY (category_ID) REFERENCES Categories(category_ID)
);

CREATE TABLE Warehouses (
    warehouse_ID INT AUTO_INCREMENT PRIMARY KEY,
    warehouse_name VARCHAR(255) NOT NULL,
    address VARCHAR(255) NOT NULL
);

CREATE TABLE Inventory (
    inventory_ID INT AUTO_INCREMENT PRIMARY KEY,
    product_ID INT,
    warehouse_ID INT,
    quantity_in_stock INT,
    last_stock_update DATE,
    FOREIGN KEY (product_ID) REFERENCES Products(product_ID),
    FOREIGN KEY (warehouse_ID) REFERENCES Warehouses(warehouse_ID)
);

CREATE TABLE Orders (
    order_ID INT AUTO_INCREMENT PRIMARY KEY,
    customer_ID INT,
    order_date DATE,
    shipping_address VARCHAR(255),
    order_status VARCHAR(50)
);

CREATE TABLE OrderItems (
    order_item_ID INT AUTO_INCREMENT PRIMARY KEY,
    order_ID INT,
    product_ID INT,
    quantity_ordered INT,
    unit_price DECIMAL(10, 2),
    FOREIGN KEY (order_ID) REFERENCES Orders(order_ID),
    FOREIGN KEY (product_ID) REFERENCES Products(product_ID)
);

CREATE TABLE Shipments (
    shipment_ID INT AUTO_INCREMENT PRIMARY KEY,
    order_ID INT,
    shipping_carrier VARCHAR(255),
    tracking_number VARCHAR(255),
    shipment_date DATE,
    FOREIGN KEY (order_ID) REFERENCES Orders(order_ID)
);


INSERT INTO Categories (category_name) VALUES 
('Refrigerators'),
('Washing Machines'),
('Air Conditioners'),
('Microwave Ovens'),
('Kitchen Appliances');

INSERT INTO Products (name, description, price, category_ID) VALUES 
('LG 260 L Double Door Refrigerator', 'Energy-efficient, sleek design refrigerator', 25000, 1),
('Samsung 7 kg Fully Automatic Washing Machine', 'High-quality, fully automatic washing machine', 30000, 2),
('Voltas 1.5 Ton Split AC', 'Effective cooling, energy-efficient AC', 35000, 3),
('Samsung 28 L Convection Microwave Oven', 'Microwave oven with multiple features', 15000, 4),
('Philips Mixer Grinder', 'Powerful mixer grinder for kitchen use', 3500, 5);

INSERT INTO Warehouses (warehouse_name, address) VALUES 
('Delhi Warehouse', 'Sector 21, New Delhi, India'),
('Mumbai Warehouse', 'Andheri, Mumbai, Maharashtra, India'),
('Bangalore Warehouse', 'Electronic City, Bangalore, Karnataka, India');

INSERT INTO Inventory (product_ID, warehouse_ID, quantity_in_stock, last_stock_update) VALUES 
(1, 1, 50, '2025-05-01'),
(2, 2, 30, '2025-05-02'),
(3, 3, 20, '2025-05-01'),
(4, 1, 10, '2025-05-01'),
(5, 2, 5, '2025-05-03');

INSERT INTO Orders (customer_ID, order_date, shipping_address, order_status) VALUES 
(101, '2025-05-03', '123, MG Road, Bangalore, Karnataka', 'Pending'),
(102, '2025-05-02', '456, Linking Road, Mumbai, Maharashtra', 'Shipped'),
(103, '2025-05-04', '789, Connaught Place, Delhi', 'Delivered');

INSERT INTO OrderItems (order_ID, product_ID, quantity_ordered, unit_price) VALUES 
(1, 1, 1, 25000),
(1, 5, 2, 3500),
(2, 2, 1, 30000),
(3, 3, 1, 35000);

INSERT INTO Shipments (order_ID, shipping_carrier, tracking_number, shipment_date) VALUES 
(2, 'BlueDart', 'BD123456', '2025-05-02'),
(3, 'DTDC', 'DT987654', '2025-05-04');


SELECT 
    c.category_name,
    COUNT(p.product_ID) AS product_count
FROM 
    Categories c
LEFT JOIN 
    Products p ON c.category_ID = p.category_ID
GROUP BY 
    c.category_ID, c.category_name;


DELIMITER //

CREATE PROCEDURE GetStockLevel(
    IN in_product_ID INT,
    IN in_warehouse_ID INT
)
BEGIN
    SELECT 
        i.product_ID,
        i.warehouse_ID,
        i.quantity_in_stock,
        i.last_stock_update
    FROM 
        Inventory i
    WHERE 
        i.product_ID = in_product_ID 
        AND i.warehouse_ID = in_warehouse_ID;
END //

DELIMITER ;

CALL GetStockLevel(1, 1);



SELECT 
    o.order_ID,
    o.order_date,
    p.name AS product_name,
    oi.quantity_ordered,
    oi.unit_price
FROM 
    Orders o
JOIN 
    OrderItems oi ON o.order_ID = oi.order_ID
JOIN 
    Products p ON oi.product_ID = p.product_ID
ORDER BY 
    o.order_ID;


CREATE VIEW LowStockProducts AS
SELECT 
    p.product_ID,
    p.name,
    SUM(i.quantity_in_stock) AS total_stock
FROM 
    Products p
JOIN 
    Inventory i ON p.product_ID = i.product_ID
GROUP BY 
    p.product_ID, p.name
HAVING 
    SUM(i.quantity_in_stock) < 10;

SELECT * FROM LowStockProducts;


SELECT 
    order_status,
    COUNT(*) AS order_count
FROM 
    Orders
GROUP BY 
    order_status;


SELECT 
    o.customer_ID,
    SUM(oi.quantity_ordered) AS total_products_ordered
FROM 
    Orders o
JOIN 
    OrderItems oi ON o.order_ID = oi.order_ID
GROUP BY 
    o.customer_ID;









