CREATE DATABASE IF NOT EXISTS HospitalDB;
USE HospitalDB;


CREATE TABLE Departments (
    DepartmentID INT PRIMARY KEY AUTO_INCREMENT,
    DepartmentName VARCHAR(100),
    Location VARCHAR(100)
);


CREATE TABLE Doctors (
    DoctorID INT PRIMARY KEY AUTO_INCREMENT,
    DoctorName VARCHAR(100),
    Specialty VARCHAR(100),
    DepartmentID INT DEFAULT 1,
    FOREIGN KEY (DepartmentID) REFERENCES Departments(DepartmentID)
);


CREATE TABLE Patients (
    PatientID INT PRIMARY KEY AUTO_INCREMENT,
    PatientName VARCHAR(100),
    DOB DATE,
    Address VARCHAR(255),
    PhoneNumber VARCHAR(15)
);


CREATE TABLE Appointments (
    AppointmentID INT PRIMARY KEY AUTO_INCREMENT,
    PatientID INT,
    DoctorID INT,
    AppointmentDate DATE,
    Created_At TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (PatientID) REFERENCES Patients(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES Doctors(DoctorID)
);


INSERT INTO Departments (DepartmentName, Location) VALUES
('Cardiology', 'First Floor'),
('Neurology', 'Second Floor'),
('Orthopedics', 'Third Floor'),
('General Medicine', 'Ground Floor');


INSERT INTO Doctors (DoctorName, Specialty, DepartmentID) VALUES
('Dr. Ramesh Verma', 'Cardiology', 1),
('Dr. Anjali Mehra', 'Neurology', 2),
('Dr. Sanjay Patil', 'Orthopedics', 3),
('Dr. Pooja Sharma', 'General Medicine', 4),
('Dr. Arvind Iyer', 'Dermatology', 4);


INSERT INTO Patients (PatientName, DOB, Address, PhoneNumber) VALUES
('Rahul Kumar', '1960-05-20', 'Delhi, India', '9876543210'),
('Sneha Gupta', '1985-08-15', 'Mumbai, India', '9876501234'),
('Amit Joshi', '1990-01-10', 'Bangalore, India', '9812345678'),
('Lakshmi Nair', '2002-11-30', 'Chennai, India', '9123456789'),
('Rajeev Ranjan', '1955-03-05', 'Patna, India', '9988776655');


INSERT INTO Appointments (PatientID, DoctorID, AppointmentDate) VALUES
(1, 1, CURDATE()),
(2, 2, CURDATE()),
(3, 3, CURDATE()),
(4, 1, CURDATE() - INTERVAL 2 DAY),
(5, 4, CURDATE() - INTERVAL 5 DAY);



SELECT * FROM Doctors
ORDER BY Specialty;



SELECT DepartmentID, COUNT(*) AS DoctorCount
FROM Doctors
GROUP BY DepartmentID;

SELECT DoctorID, COUNT(*) AS TotalAppointments
FROM Appointments
GROUP BY DoctorID;


SELECT p.PatientName, a.AppointmentDate
FROM Appointments a
JOIN Patients p ON a.PatientID = p.PatientID;


DELIMITER //
CREATE PROCEDURE GetDoctorByID(IN doc_id INT)
BEGIN
  SELECT * FROM Doctors WHERE DoctorID = doc_id;
END //
DELIMITER ;

CALL GetDoctorByID(2);



DELIMITER //
CREATE TRIGGER SetAppointmentDate
BEFORE INSERT ON Appointments
FOR EACH ROW
BEGIN
  IF NEW.AppointmentDate IS NULL THEN
    SET NEW.AppointmentDate = CURDATE();
  END IF;
END //
DELIMITER ;
INSERT INTO Appointments (PatientID, DoctorID)
VALUES (3, 1);
SELECT *
FROM Appointments
WHERE PatientID = 3
  AND DoctorID = 1
ORDER BY Created_At DESC
LIMIT 1;



