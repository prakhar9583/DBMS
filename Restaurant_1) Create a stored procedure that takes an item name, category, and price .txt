CREATE DATABASE IF NOT EXISTS RestaurantDB;
USE RestaurantDB;


CREATE TABLE Menu (
    item_ID INT PRIMARY KEY AUTO_INCREMENT,
    item_name VARCHAR(100),
    category VARCHAR(50),
    price DECIMAL(10,2)
);

CREATE TABLE Customers (
    customer_ID INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100),
    contact_number VARCHAR(15)
);

CREATE TABLE Orders (
    order_ID INT PRIMARY KEY AUTO_INCREMENT,
    customer_ID INT,
    order_date_time DATETIME,
    FOREIGN KEY (customer_ID) REFERENCES Customers(customer_ID)
);

CREATE TABLE OrderItems (
    order_ID INT,
    item_ID INT,
    quantity INT,
    unit_price DECIMAL(10,2),
    PRIMARY KEY (order_ID, item_ID),
    FOREIGN KEY (order_ID) REFERENCES Orders(order_ID),
    FOREIGN KEY (item_ID) REFERENCES Menu(item_ID)
);


INSERT INTO Menu (item_name, category, price) VALUES
('Paneer Butter Masala', 'Main Course', 220.00),
('Chicken Biryani', 'Main Course', 250.00),
('Masala Dosa', 'Snacks', 90.00),
('Samosa', 'Snacks', 20.00),
('Gulab Jamun', 'Dessert', 40.00),
('Lassi', 'Beverage', 50.00);

INSERT INTO Customers (name, contact_number) VALUES
('Rahul Sharma', '9876543210'),
('Priya Singh', '9123456789'),
('Amit Verma', '9988776655');

INSERT INTO Orders (customer_ID, order_date_time) VALUES
(1, NOW() - INTERVAL 1 DAY),
(2, NOW()),
(3, NOW());

INSERT INTO OrderItems (order_ID, item_ID, quantity, unit_price) VALUES
(1, 1, 2, 220.00),
(1, 5, 1, 40.00),
(2, 2, 1, 250.00),
(2, 6, 2, 50.00),
(3, 3, 1, 90.00);


DELIMITER $$

CREATE PROCEDURE InsertMenuItem (
    IN itemName VARCHAR(100),
    IN itemCategory VARCHAR(50),
    IN itemPrice DECIMAL(10,2)
)
BEGIN
    INSERT INTO Menu (item_name, category, price)
    VALUES (itemName, itemCategory, itemPrice);
END $$

DELIMITER ;

CALL InsertMenuItem('Veg Manchurian', 'Main Course', 160.00);


SELECT item_name, price
FROM Menu
WHERE price = (SELECT MAX(price) FROM Menu);

SELECT item_name, price
FROM Menu
WHERE price = (SELECT MIN(price) FROM Menu);


SELECT 
    category,
    COUNT(*) AS number_of_items
FROM 
    Menu
GROUP BY 
    category;


SELECT 
    AVG(item_count) AS avg_items_per_order
FROM (
    SELECT 
        order_ID,
        SUM(quantity) AS item_count
    FROM 
        OrderItems
    GROUP BY 
        order_ID
) AS OrderItemCounts;



CREATE VIEW MenuItemSalesSummary AS
SELECT 
    m.item_name,
    SUM(oi.quantity) AS total_quantity_sold,
    SUM(oi.quantity * oi.unit_price) AS total_revenue
FROM 
    OrderItems oi
JOIN 
    Menu m ON oi.item_ID = m.item_ID
GROUP BY 
    m.item_ID, m.item_name;


SELECT * FROM MenuItemSalesSummary;



SELECT 
    m.item_name
FROM 
    OrderItems oi
JOIN 
    Menu m ON oi.item_ID = m.item_ID
WHERE 
    oi.order_ID = 1; 




